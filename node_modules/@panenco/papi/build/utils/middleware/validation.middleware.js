"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validationMiddleware = void 0;
const class_transformer_1 = require("class-transformer");
const utils_1 = require("..");
/**
 * @internal
 * Middleware used by the [[`Body`]] and [[`Query`]] decorators but can also be directly used in an express middleware tree.
 * @param type The expected type of the body. Should be a class-validator class
 * @param value location of the object to validate in the express Request (body, query, params)
 * @param options class-validator [[`ValidatorOptions]] for the validation to be performed.
 *
 * @category Middleware
 */
const validationMiddleware = (type, value = 'body', options = {}, transformOptions = {}) => {
    return async (req, _, next) => {
        transformOptions.exposeUnsetFields = transformOptions.exposeUnsetFields === true ? true : false;
        const input = (0, class_transformer_1.plainToInstance)(type, req[value], transformOptions);
        await (0, utils_1.validator)(input, { skipMissingProperties: false, whitelist: true, forbidNonWhitelisted: true, ...options });
        req[value] = input;
        next();
    };
};
exports.validationMiddleware = validationMiddleware;
//# sourceMappingURL=validation.middleware.js.map